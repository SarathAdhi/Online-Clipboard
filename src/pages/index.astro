---
import PageLayout from "@layouts/PageLayout.astro";
import { supabase } from "@lib/supabase";
import AddSection from "@modules/Home/AddSection";
import IntroSectionAstro from "@modules/Home/IntroSectionAstro.astro";
import RetrieveSection from "@modules/Home/RetrieveSection";

const {
  url: { searchParams },
} = Astro;

// --- Redirect to Realtime clipboard
let realtimeCbId = searchParams.get("rtid");

if (realtimeCbId) {
  return Astro.redirect(`/realtime-clipboard?id=${realtimeCbId}`);
}

let cbId = searchParams.get("id") || "";
let _clipBoardText = "";
let _clipBoardType = "";

if (cbId) {
  const isTextEditable = cbId?.split("-")[1]?.toLocaleLowerCase() === "e";

  const { data } = await supabase
    .from(isTextEditable ? "clipboard-edit" : "clipboard")
    .select("*")
    .eq("uuid", cbId);

  if (!isTextEditable) _clipBoardText = data![0]?.text;

  _clipBoardType = data![0]?.type;
}
---

<PageLayout title="Online ClipBoard | 0cb" className="gap-4">
  <IntroSectionAstro />

  <AddSection client:load />

  <RetrieveSection
    client:load
    _clipBoardUuid={cbId}
    _clipBoardText={_clipBoardText}
    _clipBoardType={_clipBoardType}
  />
</PageLayout>
